---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: ai-rag-stack
  annotations:
    description: "DevOps AI Assistant - RAG system using local LLMs"

# Namespace for all resources
namespace: ai-rag-stack

# Common labels applied to all resources
labels:
  - pairs:
      app.kubernetes.io/part-of: ai-rag-stack
      app.kubernetes.io/managed-by: kustomize
    includeSelectors: false

# Resources to deploy
resources:
  # Namespace (must be first)
  - namespace.yaml

  # Configuration
  - configmap.yaml
  - secret.yaml

  # Core infrastructure
  - qdrant-statefulset.yaml
  - redis-deployment.yaml
  - postgres-statefulset.yaml
  - ollama-deployment.yaml

  # Application
  - backend-deployment.yaml
  - backend-service.yaml
  - backend-hpa.yaml
  - backend-pdb.yaml
  - frontend-deployment.yaml

  # Networking
  - ingress.yaml
  - networkpolicy.yaml

# Image customization (override images for different environments)
images:
  - name: jconover/ai-rag-backend
    newTag: latest
  - name: jconover/ai-rag-frontend
    newTag: latest
  - name: qdrant/qdrant
    newTag: v1.12.4
  - name: redis
    newTag: 7.4-alpine
  - name: postgres
    newTag: 16-alpine
  - name: ollama/ollama
    newTag: "0.5.4"

# Configuration generation (alternative to static configmaps)
# configMapGenerator:
#   - name: backend-config
#     envs:
#       - .env.backend

# Secret generation (for development only - use external-secrets in prod)
# secretGenerator:
#   - name: backend-secrets
#     envs:
#       - .env.secrets
